class zTextUpfunkerSingle{constructor(el,effect,maxLoops){'use strict';this.el=el;this.effect=effect||'code';this.maxLoops=maxLoops||Infinity;console.log(this.maxLoops);this.timeOuts={codes:20,chars:100,cycles:500};this.codecharacters="&µ#*+%8!¢?£1@§$";this.charEffectsClasses={code:'charCode',fade:'charFadeIn',flip:'charFlip',sink:'charSink',pop:'charPop',flkr:'charFlkr',circ:'charCirc'}
this.effects={};this.currentLoop=0;this.messages=[];this.message=0;this.init()}
init(){const prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)");if(prefersReducedMotion.matches){this.el.innerHTML=this.messages.join(' ');return}
this.el.classList.add('zMessageUpfunkerParent','zmupActive');this.setHeight();this.effects={code:this.startCodeAnimation.bind(this),fade:this.startCharAnimation.bind(this),flip:this.startCharAnimation.bind(this),sink:this.startCharAnimation.bind(this),pop:this.startCharAnimation.bind(this),flkr:this.startCharAnimation.bind(this),circ:this.startCharAnimation.bind(this)};if(this.effect&&this.effect in this.effects){}else if(this.effect==='rand'){this.effect=this.randomObjectKey(this.effects)}else{this.effect='code'}
console.log(this.effect);this.effectType=this.effects[this.effect];this.charEffectClass=this.charEffectsClasses[this.effect];this.getWordsFromElement();this.message=0;this.current_length=0;this.animateWordsBuffer=!1;this.currentChild=!1;if(this.effect=='code'){this.currentChild=document.createElement('span');this.el.append(this.currentChild)}
setTimeout(this.effectType,this.timeOuts.cycles);window.addEventListener('resize',()=>{this.resetHeight()})}
startCodeAnimation(){if(this.current_length<this.messages[this.message].length){this.current_length=this.current_length+2;if(this.current_length>this.messages[this.message].length){this.current_length=this.messages[this.message].length}
var message=this.generateRandomString(this.current_length);this.currentChild.innerHTML=message;setTimeout(this.startCodeAnimation.bind(this),this.timeOuts.codes)}else{setTimeout(this.codeAnimateWords.bind(this),this.timeOuts.codes)}}
codeAnimateWords(){if(this.animateWordsBuffer===!1){this.animateWordsBuffer=[];for(var i=0;i<this.messages[this.message].length;i++){this.animateWordsBuffer.push({c:(Math.floor(Math.random()*12))+1,l:this.messages[this.message].charAt(i)})}}
var do_cycles=!1;var message='';for(var i=0;i<(this.animateWordsBuffer.length);i++){var fader=this.animateWordsBuffer[i];if(fader.c>0){do_cycles=!0;fader.c--;message+=this.codecharacters.charAt(Math.floor(Math.random()*this.codecharacters.length))}else{message+=fader.l}}
this.currentChild.innerHTML=message;if(do_cycles===!0){setTimeout(this.codeAnimateWords.bind(this),50)}else{setTimeout(this.cycleCodeText.bind(this),this.timeOuts.cycles)}}
startCharAnimation(){this.loopCharAnimationWords()}
loopCharAnimationWords(){if(this.currentLoop>=this.maxLoops){return}
if(this.currentLoop==1){this.setHeight()}
let messageIndex=0;this.el.innerHTML='';let showNextWord=()=>{if(messageIndex>=this.messages.length){this.currentLoop++;setTimeout(this.loopCharAnimationWords.bind(this),this.timeOuts.cycles);return}
let wordSpan=document.createElement('span');wordSpan.classList.add('word');wordSpan.classList.add('word-'+messageIndex);this.el.append(wordSpan);let chars=this.splitTextToChars(this.messages[messageIndex]);let charIndex=0;let display=setInterval(()=>{let charEl=document.createElement('span');charEl.classList.add(this.charEffectClass);charEl.innerHTML=chars[charIndex];wordSpan.append(charEl);charIndex++;if(charIndex>=chars.length){clearInterval(display);messageIndex++;setTimeout(showNextWord,500)}},this.timeOuts.chars)};showNextWord()}
cycleCodeText(){this.message=this.message+1;if(this.message>=this.messages.length){this.currentLoop++;if(this.currentLoop>=this.maxLoops){return}else{this.message=0;this.el.innerHTML=''}}
this.currentChild=document.createElement('span');this.el.append(this.currentChild);this.current_length=0;this.animateWordsBuffer=!1;this.currentChild.innerHTML='';setTimeout(this.effectType,this.timeOuts.cycles)}
getWordsFromElement(){let elFirstContent=this.el.innerHTML.trim();let allElements=Array.from(elFirstContent.split(/[–, -]/g));let allElementsTrimmed=allElements.map(string=>string.trim());let allElementsFiltered=allElementsTrimmed.filter(el=>el.length>0);this.messages=allElementsFiltered;console.log(this.messages);this.el.innerHTML=''}
splitTextToChars(text){var el=document.createElement('textarea');el.innerHTML=text;let decodedText=el.value;return decodedText.split('')}
generateRandomString(length){var random_text='';while(random_text.length<length){random_text+=this.codecharacters.charAt(Math.floor(Math.random()*this.codecharacters.length))}
return random_text}
randomObjectKey(object){let eff_keys=Object.keys(object);let eff_rnd=Math.floor(Math.random()*eff_keys.length);return eff_keys[eff_rnd]}
randomObjectProp(object){let keys=Object.keys(object);return object[keys[keys.length*Math.random()<<0]]}
setHeight(){let upfunkContainerHeight=this.el.clientHeight;this.el.setAttribute('style','height:'+upfunkContainerHeight+'px')}
resetHeight(){console.log('resized');this.el.setAttribute('style','');this.currentLoop=0}}
class zTextUpfunker{constructor(options){const selector=options.elem||'';const effect=options.type||'code';const maxLoops=options.cycles||0;console.log(options);const elements=document.querySelectorAll(selector);if(!elements.length){console.warn(`[zTextUpfunker] No elements found for selector: "${selector}"`);return}
elements.forEach(el=>{if(el instanceof HTMLElement){new zTextUpfunkerSingle(el,effect,maxLoops)}})}}
if(zTextUpfunkerParams){zTextUpfunkerParams.items.forEach(item=>{new zTextUpfunker(item)})}