class zTextUpfunkerSingle{constructor(el,effect,maxLoops){'use strict';this.el=el;this.effect=effect||'code';this.maxLoops=maxLoops||Infinity;if(this.maxLoops==0)this.maxLoops=Infinity;this.timeOuts={codes:20,chars:100,cycles:1000};this.codecharacters="&µ#*+%8!¢?£1@§$";this.charEffectsClasses={code:'charCode',fade:'charFadeIn',flip:'charFlip',sink:'charSink',pop:'charPop',flkr:'charFlkr',circ:'charCirc'};this.effects={};this.currentLoop=0;this.messages=[];this.message=0;this.init()}
init(){const prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)");if(prefersReducedMotion.matches){this.el.innerHTML=this.el.innerText;return}
this.el.classList.add('zMessageUpfunkerParent','zmupActive');this.effects={code:this.startCodeAnimation.bind(this),fade:this.startCharAnimation.bind(this),flip:this.startCharAnimation.bind(this),sink:this.startCharAnimation.bind(this),pop:this.startCharAnimation.bind(this),flkr:this.startCharAnimation.bind(this),circ:this.startCharAnimation.bind(this)};if(!(this.effect in this.effects)){this.effect=this.effect==='rand'?this.randomObjectKey(this.effects):'code'}
this.effectType=this.effects[this.effect];this.charEffectClass=this.charEffectsClasses[this.effect];this.getWordsFromElement();this.message=0;this.current_length=0;this.animateWordsBuffer=!1;this.currentChild=null;if(this.effect=='code'){this.currentChild=document.createElement('span');this.el.append(this.currentChild)}
setTimeout(this.effectType,this.timeOuts.cycles);window.addEventListener('resize',()=>this.resetHeight())}
startCodeAnimation(){if(this.current_length<this.messages[this.message].length){this.current_length+=2;if(this.current_length>this.messages[this.message].length){this.current_length=this.messages[this.message].length}
const message=this.generateRandomString(this.current_length);this.currentChild.innerHTML=message;setTimeout(this.startCodeAnimation.bind(this),this.timeOuts.codes)}else{setTimeout(this.codeAnimateWords.bind(this),this.timeOuts.codes)}}
codeAnimateWords(){if(!this.animateWordsBuffer){this.animateWordsBuffer=this.messages[this.message].split('').map(char=>({c:Math.floor(Math.random()*12)+1,l:char}))}
let do_cycles=!1;let message='';for(let fader of this.animateWordsBuffer){if(fader.c>0){do_cycles=!0;fader.c--;message+=this.codecharacters.charAt(Math.floor(Math.random()*this.codecharacters.length))}else{message+=fader.l}}
this.currentChild.innerHTML=message;if(do_cycles){setTimeout(this.codeAnimateWords.bind(this),50)}else{setTimeout(this.cycleCodeText.bind(this),this.timeOuts.cycles)}}
startCharAnimation(){this.loopCharAnimationWords()}
loopCharAnimationWords(){if(this.currentLoop>=this.maxLoops)return;if(this.currentLoop==1)this.setHeight();let messageIndex=0;this.el.innerHTML='';const showNextWord=()=>{if(messageIndex>=this.messages.length){this.currentLoop++;setTimeout(this.loopCharAnimationWords.bind(this),this.timeOuts.cycles);return}
let wordSpan=document.createElement('span');wordSpan.classList.add('word',`word-${messageIndex}`);this.el.append(wordSpan);const chars=this.splitTextToChars(this.messages[messageIndex]);let charIndex=0;const display=setInterval(()=>{let charEl=document.createElement('span');charEl.classList.add(this.charEffectClass);charEl.innerHTML=chars[charIndex];wordSpan.append(charEl);charIndex++;if(charIndex>=chars.length){clearInterval(display);messageIndex++;setTimeout(showNextWord,500)}},this.timeOuts.chars)};showNextWord()}
cycleCodeText(){this.message=(this.message+1)%this.messages.length;this.el.innerHTML='';this.currentChild=document.createElement('span');this.el.append(this.currentChild);this.current_length=0;this.animateWordsBuffer=!1;this.currentChild.innerHTML='';setTimeout(this.effectType,this.timeOuts.cycles)}
getWordsFromElement(){const text=this.el.innerHTML.trim();this.messages=text.split(/[ –,-]/g).map(word=>word.trim());this.el.innerHTML=''}
splitTextToChars(text){const el=document.createElement('textarea');el.innerHTML=text;return el.value.split('')}
generateRandomString(length){return Array.from({length},()=>this.codecharacters.charAt(Math.floor(Math.random()*this.codecharacters.length))).join('')}
randomObjectKey(obj){const keys=Object.keys(obj);return keys[Math.floor(Math.random()*keys.length)]}
setHeight(){const height=this.el.clientHeight;this.el.setAttribute('style',`height:${height}px`)}
resetHeight(){this.el.removeAttribute('style');this.currentLoop=0}}
class zTextUpfunker{static initAll(options){const selector=options.elem||'';const effect=options.type||'code';const maxLoops=options.cycles||0;const elements=document.querySelectorAll(selector);if(!elements.length){console.warn(`[zTextUpfunker] No elements found for selector: "${selector}"`);return}
elements.forEach(el=>{if(el instanceof HTMLElement){new zTextUpfunkerSingle(el,effect,maxLoops)}})}}
zTextUpfunker.initAll(zTextUpfunkerParams)