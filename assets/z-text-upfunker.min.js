class zodanTextUpfunkerSingle{constructor(el,effect,maxLoops,charspeed,wordspeed,cyclespeed){'use strict';this.el=el;this.effect=effect||'code';this.maxLoops=maxLoops||Infinity;this.charspeed=charspeed||100;this.wordspeed=wordspeed||350;this.cyclespeed=cyclespeed||500;this.timeOuts={codes:20,chars:this.charspeed,words:this.wordspeed,cycles:this.cyclespeed};this.codecharacters="&µ#*+%8!¢?£1@§$";this.charEffectsClasses={code:'charCode',fade:'charFadeIn',flip:'charFlip',sink:'charSink',pop:'charPop',flkr:'charFlkr',circ:'charCirc'}
this.effects={};this.currentLoop=0;this.messages=[];this.message=0;this.init()}
init(){const prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)");if(prefersReducedMotion.matches){return}
this.el.classList.add('zMessageUpfunkerParent','zmupActive');this.setHeight();this.effects={code:this.startCodeAnimation.bind(this),fade:this.startCharAnimation.bind(this),flip:this.startCharAnimation.bind(this),sink:this.startCharAnimation.bind(this),pop:this.startCharAnimation.bind(this),flkr:this.startCharAnimation.bind(this),circ:this.startCharAnimation.bind(this)};if(this.effect&&this.effect in this.effects){}else if(this.effect==='rand'){this.effect=this.randomObjectKey(this.effects)}else{this.effect='code'}
this.effectType=this.effects[this.effect];this.charEffectClass=this.charEffectsClasses[this.effect];this.getWordsFromElement();this.el.innerHTML='';this.message=0;this.current_length=0;this.animateWordsBuffer=!1;this.currentChild=!1;if(this.effect=='code'){this.currentChild=document.createElement('span');this.el.append(this.currentChild)}
const observer=new IntersectionObserver((entries,observer)=>{entries.forEach(entry=>{if(entry.isIntersecting){const event=new CustomEvent('zUpFunkerAnimationStarted',{detail:{message:'Upfunker started',element:this.el}});this.el.dispatchEvent(event);setTimeout(this.effectType,this.timeOuts.cycles);observer.unobserve(entry.target)}})},{threshold:0.5});observer.observe(this.el);window.addEventListener('resize',()=>{this.resetHeight()})}
startCodeAnimation(){console.log('Start code animation');if(this.current_length<this.messages[this.message].length){this.current_length=this.current_length+2;if(this.current_length>this.messages[this.message].length){this.current_length=this.messages[this.message].length}
var message=this.generateRandomString(this.current_length);this.currentChild.innerHTML=message;setTimeout(this.startCodeAnimation.bind(this),this.timeOuts.codes)}else{setTimeout(this.codeAnimateWords.bind(this),this.timeOuts.codes)}}
codeAnimateWords(){if(this.animateWordsBuffer===!1){this.animateWordsBuffer=[];for(var i=0;i<this.messages[this.message].text.length;i++){this.animateWordsBuffer.push({c:(Math.floor(Math.random()*12))+1,l:this.messages[this.message].text.charAt(i)})}}
var do_cycles=!1;var message='';for(var i=0;i<(this.animateWordsBuffer.length);i++){var fader=this.animateWordsBuffer[i];if(fader.c>0){do_cycles=!0;fader.c--;message+=this.codecharacters.charAt(Math.floor(Math.random()*this.codecharacters.length))}else{message+=fader.l}}
this.currentChild.innerHTML=message;if(do_cycles===!0){setTimeout(this.codeAnimateWords.bind(this),50)}else{setTimeout(this.cycleCodeText.bind(this),this.timeOuts.cycles)}}
startCharAnimation(){this.loopCharAnimationWords()}
loopCharAnimationWords(){if(this.currentLoop>=this.maxLoops){const event=new CustomEvent('zUpFunkerAnimationEnded',{detail:{message:'UpFunker completed all animations',element:this.el}});this.el.dispatchEvent(event);return}
if(this.currentLoop==1){this.setHeight()}
let messageIndex=0;this.el.innerHTML='';let showNextWord=()=>{if(messageIndex>=this.messages.length){this.currentLoop++;setTimeout(this.loopCharAnimationWords.bind(this),this.timeOuts.cycles);return}
const msg=this.messages[messageIndex];let wordSpan;if(msg.tag){wordSpan=document.createElement(msg.tag);msg.classList.forEach(cls=>wordSpan.classList.add(cls));if(msg.style)wordSpan.setAttribute('style',msg.style);}else{wordSpan=document.createElement('span')}
wordSpan.classList.add('word','word-'+messageIndex);this.el.append(wordSpan);const chars=Array.from(msg.text);let charIndex=0;const display=setInterval(()=>{const charEl=document.createElement('span');charEl.classList.add(this.charEffectClass);charEl.textContent=chars[charIndex];wordSpan.append(charEl);charIndex++;if(charIndex>=chars.length){clearInterval(display);messageIndex++;setTimeout(showNextWord,this.timeOuts.wordspeed)}},this.timeOuts.chars)};showNextWord()}
cycleCodeText(){this.message=this.message+1;if(this.message>=this.messages.length){this.currentLoop++;if(this.currentLoop>=this.maxLoops){const event=new CustomEvent('zUpFunkerAnimationEnded',{detail:{message:'UpFunker completed all animations',element:this.el}});this.el.dispatchEvent(event);return}else{this.message=0;this.el.innerHTML=''}}
this.currentChild=document.createElement('span');this.el.append(this.currentChild);this.current_length=0;this.animateWordsBuffer=!1;this.currentChild.innerHTML='';setTimeout(this.effectType,this.timeOuts.cycles)}
getWordsFromElement(){const collectWords=(node,inherited={})=>{Array.from(node.childNodes).forEach(child=>{if(child.nodeType===Node.TEXT_NODE){const text=child.textContent.trim();if(!text)return;text.split(/\s+/).forEach(word=>{if(!word)return;this.messages.push({text:word,tag:inherited.tag||null,classList:inherited.classList||[],style:inherited.style||''})})}else if(child.nodeType===Node.ELEMENT_NODE){const inheritedAttrs={tag:child.tagName.toLowerCase(),classList:Array.from(child.classList),style:child.getAttribute('style')||''};collectWords(child,inheritedAttrs)}})};this.messages=[];collectWords(this.el);this.el.innerHTML=''}
splitTextToChars(text){return Array.from(text)}
generateRandomString(length){var random_text='';while(random_text.length<length){random_text+=this.codecharacters.charAt(Math.floor(Math.random()*this.codecharacters.length))}
return random_text}
randomObjectKey(object){let eff_keys=Object.keys(object);let eff_rnd=Math.floor(Math.random()*eff_keys.length);return eff_keys[eff_rnd]}
randomObjectProp(object){let keys=Object.keys(object);return object[keys[keys.length*Math.random()<<0]]}
setHeight(){let upfunkContainerHeight=this.el.clientHeight;this.el.setAttribute('style','height:'+upfunkContainerHeight+'px')}
resetHeight(){this.el.setAttribute('style','');this.currentLoop=0}}
class zodanTextUpfunker{constructor(options){const selector=options.elem||'';const effect=options.type||'code';const maxLoops=options.cycles||0;const charspeed=options.charspeed||100;const wordspeed=options.wordspeed||350;const cyclespeed=options.cyclespeed||500;const elements=document.querySelectorAll(selector);if(!elements.length){return}
elements.forEach(el=>{if(el instanceof HTMLElement){new zodanTextUpfunkerSingle(el,effect,maxLoops,charspeed,wordspeed,cyclespeed)}})}}
if(zodanTextUpfunkerParams){zodanTextUpfunkerParams.items.forEach(item=>{new zodanTextUpfunker(item)})}